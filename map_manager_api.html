<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.8.1: http://docutils.sourceforge.net/" />
<title></title>
<meta name="author" content="Stéphane Magnenat &lt;stephane at magnenat dot net&gt;" />
<meta name="date" content="2013-02-11" />
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7056 2011-06-17 10:50:48Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">

<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr class="field"><th class="docinfo-name">Info:</th><td class="field-body">A map manager API for 3D mapping, navigation and scene interpretation</td>
</tr>
<tr><th class="docinfo-name">Author:</th>
<td>Stéphane Magnenat &lt;stephane at magnenat dot net&gt;</td></tr>
<tr><th class="docinfo-name">Date:</th>
<td>2013-02-11</td></tr>
</tbody>
</table>
<div class="section" id="a-map-manager-api-for-3d-mapping-navigation-and-scene-interpretation">
<h1>A map manager API for 3D mapping, navigation and scene interpretation</h1>
<div class="section" id="rationale">
<h2>Rationale</h2>
<p>A modern autonomous robotic system is composed of many building blocks (SLAM, path planning, scene interpretation), most of them depending on some form of localisation and mapping.
Therefore, there is a need for an API that allows these different elements to communicate, with as little interdependency as possible.
This document describes such an API, based on the concept of a transactional map database.
It aims at being as generic as possible and agnostic with respect to the implementation framework.</p>
</div>
<div class="section" id="framework-requirements">
<h2>Framework requirements</h2>
<p>The implementation framework shall allow modularity based on the concept of components.
It shall provide both message passing (called <em>message</em> in the rest of this document) and remote procedure invocation (called <em>RPC</em> in the rest of this document) for interfacing modules together.</p>
</div>
<div class="section" id="writing-conventions">
<h2>Writing conventions</h2>
<p>When variables are described, the convention <tt class="docutils literal">variable: Type</tt> is used, with <tt class="docutils literal">variable</tt> having its first letter in lower case and <tt class="docutils literal">Type</tt> in upper case, and using <em>CamelCase</em> for multiple words.</p>
<p>When RPC or messages are described, the convention <tt class="docutils literal">name(arguments) <span class="pre">-&gt;</span> ReturnType</tt> is used, in CameCase as well.</p>
</div>
<div class="section" id="concepts">
<h2>Concepts</h2>
<dl class="docutils">
<dt>Frame</dt>
<dd>A frame is a coordinate frame located in 3-D space, in relation with other frames through a set of probabilistic transformations.
These are encoding as <strong>SM: What is this encoding?</strong>
Frames have unique identifiers, and can optionally have human-readable names.</dd>
<dt>EstimatedFrame</dt>
<dd>A graph of frames can be relaxed to have non-probabilistic poses.</dd>
<dt>Transaction</dt>
<dd>All map queries (excepted trigger bookkeeping) must be performed in a transaction, during which the world is assured to be consistent when viewed from the client.
A transaction might fail in case of write conflict.
The suggested paradigm for implementating transactions is <em>multiversion concurrency control</em>.</dd>
<dt>Trigger</dt>
<dd>Clients can create triggers to watch part of the database and be notified of changes asynchronously.</dd>
</dl>
</div>
<div class="section" id="data-types-used-in-interfaces">
<h2>Data types used in interfaces</h2>
<dl class="docutils">
<dt><tt class="docutils literal">TransactionId</tt></dt>
<dd>The unique identifier of a transaction, a <tt class="docutils literal">Uint64</tt>.</dd>
<dt><tt class="docutils literal">FrameId</tt></dt>
<dd>The unique identifier of a frame, a <tt class="docutils literal">Uint64</tt>.</dd>
<dt><tt class="docutils literal">FrameIds</tt></dt>
<dd>A list of <tt class="docutils literal">FrameId</tt>.</dd>
<dt><tt class="docutils literal">FrameName</tt></dt>
<dd>A human-readable text naming important frames, like &quot;world&quot;, a <tt class="docutils literal">String</tt>.</dd>
<dt><tt class="docutils literal">Transform</tt></dt>
<dd>A non-probabilistic 3-D transformation, in SO(3), implemented as a 4x4 matrix of <tt class="docutils literal">Float64</tt>.</dd>
<dt><tt class="docutils literal">EstimatedFrame</tt></dt>
<dd>A tuple <tt class="docutils literal">(id: FrameId, transform: Transform)</tt> representing a frame with coordinates estimated with respect to another frame.</dd>
<dt><tt class="docutils literal">EstimatedFrames</tt></dt>
<dd>A list of <tt class="docutils literal">EstimatedFrame</tt>.</dd>
<dt><tt class="docutils literal">ProbTransform</tt></dt>
<dd>A probabilistic 3-D transformation <strong>SM: What is this encoding?</strong></dd>
<dt><tt class="docutils literal">LinkId</tt></dt>
<dd>A tuple <tt class="docutils literal">(frame0: FrameId, frame1: FrameId)</tt>.</dd>
<dt><tt class="docutils literal">LinkIds</tt></dt>
<dd>A list of <tt class="docutils literal">LinkId</tt>.</dd>
<dt><tt class="docutils literal">Link</tt></dt>
<dd>A tuple <tt class="docutils literal">(LinkId: link, transformation: ProbTransform, confidence: Float64)</tt>.</dd>
<dt><tt class="docutils literal">Links</tt></dt>
<dd>A list of <tt class="docutils literal">Link</tt>.</dd>
<dt><tt class="docutils literal">DataType</tt></dt>
<dd>A type of data to be attached to a frame, a <tt class="docutils literal">String</tt>.</dd>
<dt><tt class="docutils literal">DataTypes</tt></dt>
<dd>A list of <tt class="docutils literal">DataType</tt>.</dd>
<dt><tt class="docutils literal">DataBlob</tt></dt>
<dd>Opaque binary data.</dd>
<dt><tt class="docutils literal">Data</tt></dt>
<dd>Data with type as a tuple <tt class="docutils literal">(type: DataType, value: DataBlob)</tt></dd>
<dt><tt class="docutils literal">DataSet</tt></dt>
<dd>A (multi)map of <tt class="docutils literal">FrameId <span class="pre">-&gt;</span> Data</tt>.</dd>
<dt><tt class="docutils literal">Box</tt></dt>
<dd>A three-dimensional box in space defined by its two opposite corners, hence a pair of tuples <tt class="docutils literal">((xmin: Float64, ymin: Float64, zmin: Float64), (xmax: Float64, ymax: Float64, zmax: Float64))</tt>.
<strong>SM: say something about degenerate case, like if we are in 2D</strong></dd>
<dt><tt class="docutils literal">TriggerId</tt></dt>
<dd>Trigger identifier; because it refers to the transport mechanism and not to the database scheme, its type is implementation-dependent.</dd>
<dt><tt class="docutils literal">TriggerIds</tt></dt>
<dd>A list of <tt class="docutils literal">TriggerId</tt>.</dd>
</dl>
</div>
<div class="section" id="map-queries-rpc">
<h2>Map queries (RPC)</h2>
<div class="section" id="transaction">
<h3>Transaction</h3>
<dl class="docutils">
<dt><tt class="docutils literal">startTransaction() <span class="pre">-&gt;</span> TransactionId</tt></dt>
<dd>Create a new transaction and return its identifier.</dd>
<dt><tt class="docutils literal">commitTransaction(transaction: TransactionId) <span class="pre">-&gt;</span> (Bool, String)</tt></dt>
<dd>Attempt to commit a transaction, return whether it succeeded or failed, and the message.
Read-only transactions always succeed.
Transactions involving write might fail if there is a write conflict.
The granularity of their detection depends on the implementation.</dd>
<dt><tt class="docutils literal">abortTransaction(transaction: TransactionId, reason: String)</tt></dt>
<dd>Abort a transaction, giving a reason for server logs.</dd>
</dl>
<p>All further messages in this section are assumed to take a <tt class="docutils literal">TransactionId</tt> as first parameter.
For clarity, these are not written explicitely in the following RPC signatures.</p>
</div>
<div class="section" id="relaxation">
<h3>Relaxation</h3>
<dl class="docutils">
<dt><tt class="docutils literal">estimateFrames(origin: FrameId) <span class="pre">-&gt;</span> EstimatedFrames</tt></dt>
<dd>Return all frames linked to <tt class="docutils literal">origin</tt>
Their coordinates are relative to <tt class="docutils literal">origin</tt>, which therefore is identity.</dd>
<dt><tt class="docutils literal">estimateFramesWithinBox(origin: FrameId, box: Box) <span class="pre">-&gt;</span> EstimatedFrames</tt></dt>
<dd>Return all frames linked to <tt class="docutils literal">origin</tt> within <tt class="docutils literal">box</tt> (centered on <tt class="docutils literal">origin</tt>).
Their coordinates are relative to <tt class="docutils literal">origin</tt>, which therefore is identity.</dd>
<dt><tt class="docutils literal">estimateFramesWithinSphere(origin: FrameId, radius: Float64) <span class="pre">-&gt;</span> EstimatedFrames</tt></dt>
<dd>Return all frames linked to <tt class="docutils literal">origin</tt> within <tt class="docutils literal">radius</tt> (centered on <tt class="docutils literal">origin</tt>).
Their coordinates are relative to <tt class="docutils literal">origin</tt>, which therefore is identity.</dd>
<dt><tt class="docutils literal">estimateNeighboringFrames(origin: FrameId, linkDist: Uint64, radius: Float64) <span class="pre">-&gt;</span> EstimatedFrames</tt></dt>
<dd>Return frames linked to <tt class="docutils literal">origin</tt> within <tt class="docutils literal">radius</tt> (centered on <tt class="docutils literal">origin</tt>) and at maximum <tt class="docutils literal">linkDist</tt> number of links.
Their coordinates are relative to <tt class="docutils literal">origin</tt>, which therefore is identity.</dd>
</dl>
</div>
<div class="section" id="data-access">
<h3>Data access</h3>
<dl class="docutils">
<dt><tt class="docutils literal">getData(frames: FrameIds, types: DataTypes) <span class="pre">-&gt;</span> DataSet</tt></dt>
<dd>Return all data of <tt class="docutils literal">types</tt> contained in <tt class="docutils literal">frames</tt>.</dd>
<dt><tt class="docutils literal">getLinks(links: LinkIds) <span class="pre">-&gt;</span> Links</tt></dt>
<dd>Return requested links, if they exist.
In <tt class="docutils literal">LinkId</tt> in <tt class="docutils literal">links</tt>, also consider permuted frame identifiers.</dd>
<dt><tt class="docutils literal">getFrameLinks(frame: FrameId) <span class="pre">-&gt;</span> Links</tt></dt>
<dd>Return all links touching frame.</dd>
<dt><tt class="docutils literal">getFrameName(frame: FrameId) <span class="pre">-&gt;</span> String</tt></dt>
<dd>Get the human-readable name of a frame.</dd>
</dl>
</div>
<div class="section" id="setters">
<h3>Setters</h3>
<dl class="docutils">
<dt><tt class="docutils literal">setLink(frame0: FrameId, frame1: FrameId, transform: ProbTransform, confidence: Float64)</tt></dt>
<dd>Set a link between two frames, if the link (or its reverse) exists, its transform and confidence are replaced.</dd>
<dt><tt class="docutils literal">deleteLink(frame0: FrameId, frame1: FrameId)</tt></dt>
<dd>Remove the link (or its reverse) between two frames.</dd>
<dt><tt class="docutils literal">setFrameData(frame: FrameId, Data: data)</tt></dt>
<dd>Set data for <tt class="docutils literal">frame</tt>, if <tt class="docutils literal">data.type</tt> already exists, the corresponding data are overwritten.</dd>
<dt><tt class="docutils literal">deleteData(frame: FrameId, type: DataType)</tt></dt>
<dd>Delete data of a give type in a given frame.</dd>
<dt><tt class="docutils literal">createFrame() <span class="pre">-&gt;</span> FrameId</tt></dt>
<dd>Create and return a new FrameId, which is guaranteed to be unique.</dd>
<dt><tt class="docutils literal">setFrameName(name: String)</tt></dt>
<dd>Set the human-readable name of a frame.</dd>
<dt><tt class="docutils literal">deleteFrame(frame: FrameId)</tt></dt>
<dd>Delete a frame, all its links and all its data.</dd>
</dl>
</div>
</div>
<div class="section" id="triggers-messages">
<h2>Triggers (messages)</h2>
<div class="section" id="available-types">
<h3>Available types</h3>
<dl class="docutils">
<dt><tt class="docutils literal">linksChanged(added: Links, removed: Links)</tt></dt>
<dd>Links have been added to or removed from a set of watched frames.</dd>
<dt><tt class="docutils literal">dataChanged(frames: FrameIds, type: DataType)</tt></dt>
<dd>Data have been changed for a set of watched frames and a data type.</dd>
<dt><tt class="docutils literal">framesMoved(frames: FrameIds, origin: FrameId)</tt></dt>
<dd>A set of frames have been moved with respect to <tt class="docutils literal">origin</tt>.</dd>
</dl>
</div>
<div class="section" id="id1">
<h3>Setters</h3>
<p>These trigger-bookkeeping queries do not operate within transactions and might fail, by returning invalid trigger identifiers.</p>
<dl class="docutils">
<dt><tt class="docutils literal">watchLinks(frames: FrameIds, existingTrigger = null: TriggerId) <span class="pre">-&gt;</span> TriggerId</tt></dt>
<dd>Watch a set of frames for link changes, return the trigger identifier.
Optionally reuse an existing trigger of the same type.
All frames must exist, otherwise this query fails.</dd>
<dt><tt class="docutils literal">watchData(frames: FrameIds, type: DataType, existingTrigger = null: TriggerId) <span class="pre">-&gt;</span> TriggerId</tt></dt>
<dd>Watch a set of frames for data changes, return the trigger identifier.
Optionally reuse an existing trigger of the same type.
All frames must exist, otherwise this query fails.</dd>
<dt><tt class="docutils literal">watchEstimatedTransforms(frames: FrameIds, origin: FrameId, epsilon: (Float64, Float64), existingTrigger = null: TriggerId) <span class="pre">-&gt;</span> TriggetId</tt></dt>
<dd>Watch a set of frames for estimated pose changes with respect to origin.
Set the threshold in (translation, rotation) below which no notification occurs.
All frames must exist and have a link to origin, otherwise this query fails.</dd>
<dt><tt class="docutils literal">deleteTriggers(triggers: TriggerIds)</tt></dt>
<dd>Delete triggers if they exist.</dd>
</dl>
</div>
</div>
</div>
</div>
</body>
</html>
